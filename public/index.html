<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÂãïÁîª ‚Üí MP4 10MB‰ª•‰∏ã Â§âÊèõ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f0f12;
      --surface: #1a1a1f;
      --surface-hover: #24242b;
      --border: #2d2d36;
      --text: #e8e8ed;
      --text-muted: #8b8b9a;
      --accent: #6c5ce7;
      --accent-hover: #7d6ef7;
      --success: #00d68f;
      --error: #ff6b6b;
      --radius: 12px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
    }

    .container {
      max-width: 560px;
      width: 100%;
    }

    header {
      text-align: center;
      margin-bottom: 2.5rem;
    }
    h1 {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 0.5rem;
    }
    .subtitle {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .dropzone {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 3rem 2rem;
      text-align: center;
      background: var(--surface);
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    .dropzone:hover, .dropzone.dragover {
      border-color: var(--accent);
      background: var(--surface-hover);
    }
    .dropzone input { display: none; }
    .dropzone-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      opacity: 0.7;
    }
    .dropzone p {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }
    .dropzone .formats {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--accent);
      margin-top: 0.5rem;
    }

    .file-list {
      margin-top: 1.5rem;
    }
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--surface);
      border-radius: 8px;
      margin-bottom: 0.5rem;
      border: 1px solid var(--border);
    }
    .file-item .name {
      font-size: 0.9rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 70%;
    }
    .file-item .size {
      font-size: 0.8rem;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', monospace;
    }
    .file-item .remove {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 0.25rem;
      font-size: 1.2rem;
      line-height: 1;
      border-radius: 4px;
    }
    .file-item .remove:hover { color: var(--error); }

    .convert-btn {
      width: 100%;
      margin-top: 1.5rem;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      font-family: inherit;
      color: white;
      background: var(--accent);
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background 0.2s;
    }
    .convert-btn:hover:not(:disabled) { background: var(--accent-hover); }
    .convert-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .loading {
      display: none;
      text-align: center;
      padding: 2rem;
    }
    .loading.active { display: block; }
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 1rem;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .results {
      margin-top: 1.5rem;
    }
    .result-item {
      padding: 1rem;
      background: var(--surface);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .result-item.error { border-color: var(--error); }
    .result-item .info { flex: 1; min-width: 0; }
    .result-item .original { font-size: 0.85rem; color: var(--text-muted); }
    .result-item .output { font-size: 0.95rem; margin-top: 0.25rem; }
    .result-item .output-size { font-size: 0.8rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; margin-top: 0.25rem; }
    .result-item .badge {
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      background: rgba(108, 92, 231, 0.3);
      color: var(--accent);
    }
    .result-item .download-btn {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      font-family: inherit;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
    }
    .result-item .download-btn:hover { background: var(--accent-hover); }
    .result-item.error .download-btn { display: none; }
    .result-item .error-msg { color: var(--error); font-size: 0.9rem; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ÂãïÁîª ‚Üí MP4 10MB‰ª•‰∏ã</h1>
      <p class="subtitle">mov / mp4 „Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶Â§âÊèõ„Éª„Éà„É™„É†</p>
    </header>

    <div class="dropzone" id="dropzone">
      <input type="file" id="fileInput" accept=".mov,.mp4,video/quicktime,video/mp4" multiple>
      <div class="dropzone-icon">üé¨</div>
      <p>„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó„ÅßÂãïÁîª„ÇíÈÅ∏Êäû</p>
      <p class="formats">ÂØæÂøúÂΩ¢Âºè: .mov .mp4</p>
    </div>

    <div class="file-list" id="fileList"></div>

    <button class="convert-btn" id="convertBtn" disabled>Â§âÊèõ„Åô„Çã</button>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Â§âÊèõ‰∏≠...</p>
    </div>

    <div class="results" id="results"></div>
  </div>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const convertBtn = document.getElementById('convertBtn');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');

    let selectedFiles = [];

    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
    }

    function renderFileList() {
      fileList.innerHTML = selectedFiles.map((f, i) => `
        <div class="file-item">
          <span class="name" title="${f.name}">${f.name}</span>
          <span class="size">${formatSize(f.size)}</span>
          <button class="remove" data-index="${i}" aria-label="ÂâäÈô§">√ó</button>
        </div>
      `).join('');
      convertBtn.disabled = selectedFiles.length === 0;

      fileList.querySelectorAll('.remove').forEach(btn => {
        btn.addEventListener('click', () => {
          selectedFiles.splice(+btn.dataset.index, 1);
          renderFileList();
        });
      });
    }

    function addFiles(files) {
      const valid = Array.from(files).filter(f => {
        const ext = f.name.split('.').pop().toLowerCase();
        return ['mov', 'mp4'].includes(ext);
      });
      selectedFiles.push(...valid);
      renderFileList();
    }

    dropzone.addEventListener('click', () => fileInput.click());
    dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.classList.add('dragover'); });
    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      dropzone.classList.remove('dragover');
      addFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener('change', e => addFiles(e.target.files));

    convertBtn.addEventListener('click', async () => {
      if (selectedFiles.length === 0) return;
      loading.classList.add('active');
      results.innerHTML = '';
      convertBtn.disabled = true;

      const formData = new FormData();
      selectedFiles.forEach(f => formData.append('videos', f));

      try {
        const res = await fetch('/api/convert', {
          method: 'POST',
          body: formData,
        });
        const data = await res.json();

        if (!res.ok) throw new Error(data.error || 'Â§âÊèõ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');

        results.innerHTML = data.results.map(r => {
          if (r.error) {
            return `
              <div class="result-item error">
                <div class="info">
                  <div class="original">${r.original}</div>
                  <div class="error-msg">${r.error}</div>
                </div>
              </div>
            `;
          }
          return `
            <div class="result-item">
              <div class="info">
                <div class="original">${r.original}</div>
                <div class="output">${r.output} ${r.trimmed ? '<span class="badge">„Éà„É™„É†Ê∏à</span>' : ''}</div>
                <div class="output-size">${formatSize(r.fileSize || 0)}</div>
              </div>
              <a class="download-btn" href="${r.downloadUrl}" download>„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</a>
            </div>
          `;
        }).join('');
      } catch (err) {
        results.innerHTML = `<div class="result-item error"><div class="error-msg">${err.message}</div></div>`;
      } finally {
        loading.classList.remove('active');
        convertBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
